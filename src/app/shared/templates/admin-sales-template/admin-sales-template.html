<div class="admin-sales">
  <!-- HEADER -->
  <div class="admin-sales__header">
    <h1 class="admin-sales__title">Estadísticas de Ventas</h1>
    <p class="admin-sales__subtitle">Resumen de ingresos y análisis de desempeño</p>
  </div>

  <!-- STATS GRID (Cards Overview) -->
  <section class="admin-sales__stats">
    @for (card of salesCards(); track card.title) {
      <app-stats-card [data]="card" />
    }
  </section>

  <!-- ABANDONED CARTS SECTION -->
  <div class="admin-sales__abandoned-section">
    <div class="admin-sales__section-header">
      <h2 class="admin-sales__section-title">Carritos Abandonados</h2>
      <span class="admin-sales__section-badge">{{ abandonedCount() }}</span>
    </div>

    @if (isLoadingAbandoned()) {
      <div class="admin-sales__loading">
        <p>Cargando carritos abandonados...</p>
      </div>
    } @else if (abandonedCarts().length === 0) {
      <div class="admin-sales__empty">
        <p>No hay carritos abandonados en las últimas 24 horas</p>
      </div>
    } @else {
      <div class="admin-sales__abandoned-table">
        <table>
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Productos</th>
              <th>Monto Total</th>
              <th>Última Actividad</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            @for (cart of abandonedCarts(); track cart.id) {
              <tr class="abandoned-row">
                <td class="user-cell">
                  <div class="user-info">
                    <span class="user-name">{{ cart.user.name || 'Usuario sin nombre' }}</span>
                    <span class="user-email">{{ cart.user.email || 'Sin email' }}</span>
                  </div>
                </td>
                <td class="products-cell">
                  <div class="products-list">
                    @if (cart.items && cart.items.length > 0) {
                      @for (item of cart.items.slice(0, 2); track item.id) {
                        <div class="product-item">
                          <span class="product-name">{{ item.product.name }}</span>
                          <span class="product-qty">x{{ item.quantity }}</span>
                        </div>
                      }
                      @if (cart.items.length > 2) {
                        <span class="more-items">+{{ cart.items.length - 2 }} más</span>
                      }
                    } @else {
                      <span class="no-items">Sin productos</span>
                    }
                  </div>
                </td>
                <td class="amount-cell">
                  {{ formatCurrency(cart.totalAmount) }}
                </td>
                <td class="date-cell">
                  {{ cart.lastActivityAt ? (cart.lastActivityAt | date: 'short') : 'No disponible' }}
                </td>
                <td class="status-cell">
                  <span class="status-badge abandoned">Abandonado</span>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>
</div>
