<section class="profile-template">
  <div class="profile-template__container">
    <h1 class="profile-template__title">Mi Perfil</h1>

    @if (errorMessage()) {
      <div class="profile-template__error">{{ errorMessage() }}</div>
    }

    @if (isLoading()) {
      <div class="profile-template__loading">Cargando...</div>
    }

    @if (userProfile()) {
      <form [formGroup]="form()" (ngSubmit)="saveChanges()" class="profile-template__form">
        <!-- Datos de usuario -->
        <div>
          <label>Nombre</label>
          <input id="profile-name" class="profile-template__input" type="text" formControlName="name" placeholder="Nombre Apellido" />
        </div>
        <div>
          <label>Email</label>
          <input id="profile-email" class="profile-template__input" type="email" formControlName="email" placeholder="usuario@email.com" />
        </div>

        <!-- Seleccionar direcci贸n -->
        <div>
          <label>Ver m谩s datos personales (click en editar)</label>
          <select id="profile-address-select" class="profile-template__input" formControlName="addressSelect" (change)="onAddressSelected($any($event.target).value)">
            <option value="">-- Selecciona una direcci贸n --</option>
            @for (address of addresses(); track address.id) {
              <option value="{{ address.id }}">
                {{ address.recipientName }} - {{ address.streetAddress }}, {{ address.city }}
              </option>
            }
          </select>
        </div>

        <!-- Datos de direcci贸n (se rellenan autom谩ticamente) -->
        @if (selectedAddress()) {
          <div>
            <label>Tel茅fono</label>
            <input id="profile-phone" class="profile-template__input" type="tel" formControlName="phone" placeholder="1234567890" />
          </div>
          <div>
            <label>Direcci贸n Completa</label>
            <input id="profile-address1" class="profile-template__input" type="text" formControlName="address" placeholder="Calle Falsa 123, Villa Mar铆a, C贸rdoba, Argentina" />
          </div>
          <div>
            <label>Direcci贸n 2 (solo lectura)</label>
            <input id="profile-address2" class="profile-template__input" type="text" formControlName="address2" />
          </div>
        }

        @if (isEditing()) {
          <button type="submit" [disabled]="form().invalid || isLoading()">Guardar cambios</button>
          <button type="button" (click)="toggleEdit()">Cancelar</button>
        } @else {
          <button type="button" (click)="toggleEdit()">Editar perfil</button>
        }
        <button type="button" class="profile-template__delete-btn" (click)="deleteAccount()">Eliminar cuenta</button>
        <button type="button" class="profile-template__action profile-template__action--secondary" (click)="verPedidos()">Ver mis pedidos</button>
        @if (isAdmin()) {
          <button type="button" class="profile-template__action profile-template__action--admin" (click)="goToDashboard()"> Ir al Dashboard Admin</button>
        }
      </form>
    }
  </div>
</section>
