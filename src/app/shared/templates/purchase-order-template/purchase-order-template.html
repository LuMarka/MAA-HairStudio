<div class="purchase-order">
  <!-- Step Indicator -->
  <div class="purchase-order__header">
    <div class="container">
      <h1 class="purchase-order__main-title">Finalizar Pedido</h1>
      <p class="purchase-order__subtitle">Completa tu información para procesar tu pedido</p>

      <div class="steps-indicator">
        <div class="step" [class.active]="currentStep() >= 1" [class.completed]="currentStep() > 1">
          <div class="step__circle">
            <span class="step__number">1</span>
            @if (currentStep() > 1) {
              <span class="step__check">✓</span>
            }
          </div>
          <div class="step__content">
            <span class="step__title">Datos</span>
            <span class="step__subtitle">Información personal</span>
          </div>
        </div>

        <div class="step__separator"></div>

        <div class="step" [class.active]="currentStep() >= 2" [class.completed]="currentStep() > 2">
          <div class="step__circle">
            <span class="step__number">2</span>
            @if (currentStep() > 2) {
              <span class="step__check">✓</span>
            }
          </div>
          <div class="step__content">
            <span class="step__title">Método de Pago</span>
            <span class="step__subtitle">Selecciona tu opción</span>
          </div>
        </div>

        <div class="step__separator"></div>

        <div class="step" [class.active]="currentStep() >= 3">
          <div class="step__circle">
            <span class="step__number">3</span>
          </div>
          <div class="step__content">
            <span class="step__title">Confirmación</span>
            <span class="step__subtitle">Revisar y confirmar</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 1: Personal Data Form -->
  @if (currentStep() === 1) {
    <app-form-personal-data
      [deliveryOption]="selectedDeliveryOption()"
      [initialData]="personalFormData() || {}"
      (formDataChange)="onPersonalFormDataChange($event)"
      (formValidChange)="onPersonalFormValidChange($event)"
      (editCart)="onEditCartFromForm()"
      (continue)="onContinueFromForm()">
    </app-form-personal-data>
  }

  <!-- Step 2: Payment Method -->
  @if (currentStep() === 2) {
    <app-methode-pay
      [orderData]="orderData()"
      [selectedPaymentMethod]="selectedPaymentMethod()"
      [selectedDeliveryOption]="selectedDeliveryOption()"
      (paymentMethodChange)="onPaymentMethodChange($event)"
      (previousStep)="onPreviousStep()"
      (nextStep)="onNextStep()">
    </app-methode-pay>
  }

  <!-- Step 3: Final Confirmation -->
  @if (currentStep() === 3) {
    <app-confirmation
      [orderData]="orderData()"
      [selectedPaymentMethod]="selectedPaymentMethod()"
      [selectedDeliveryOption]="selectedDeliveryOption()"
      [cartItems]="cartItems()"
      [subtotal]="subtotal()"
      [ivaAmount]="ivaAmount()"
      [totalWithIva]="totalWithIva()"
      [orderSent]="orderSent()"
      [isProcessing]="isProcessing()"
      (editCart)="onEditCart()"
      (previousStep)="onPreviousStep()"
      (finalizeOrder)="onFinalizeOrder()"
      (backToHome)="onBackToHome()">
    </app-confirmation>
  }
</div>
