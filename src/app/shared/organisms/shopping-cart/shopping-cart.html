<!-- Carrito de Compras -->
<div class="cart">
  <div class="cart__header">
    <h1 class="cart__title">Datos de contacto y entrega</h1>
    @if (!isEmpty()) {
      <span class="cart__count">{{ totalItems() }} producto(s)</span>
    }
  </div>

  @if (isEmpty()) {
    <div class="cart--empty">
      <div class="cart__empty">
        <div class="cart__empty-icon">üõí</div>
        <h2 class="cart__empty-title">Tu carrito est√° vac√≠o</h2>
        <p class="cart__empty-text">
          Explora nuestros productos profesionales para el cabello y encuentra lo que necesitas.
        </p>
        <button
          type="button"
          class="cart__btn cart__btn--primary"
          (click)="continueShopping()">
          Continuar comprando
        </button>
      </div>
    </div>
  } @else {
    <div class="cart__content">
      <!-- Lista de productos -->
      <div class="cart__items">
        @for (item of items(); track item.id) {
          <div class="cart-item">
            @if (item.image) {
              <div class="cart-item__image-container">
                <img
                  [src]="item.image"
                  [alt]="item.name"
                  class="cart-item__image">
              </div>
            }

            <div class="cart-item__info">
              <div class="cart-item__details">
                <h3 class="cart-item__name">{{ item.name }}</h3>
                @if (item.brand) {
                  <p class="cart-item__brand">{{ item.brand }}</p>
                }
                @if (item.description) {
                  <p class="cart-item__description">{{ item.description }}</p>
                }
              </div>

              <div class="cart-item__controls">
                <div class="cart-item__bottom-row">
                  <!-- Precio unitario -->
                  <div class="cart-item__price-mobile">
                    @if (item.originalPrice && item.originalPrice > item.price) {
                      <span class="cart-item__original-price">
                        ${{ item.originalPrice.toFixed(2) }}
                      </span>
                    }
                    <span class="cart-item__price">
                      ${{ item.price.toFixed(2) }}
                    </span>
                  </div>

                  <!-- Controles de cantidad -->
                  <div class="cart-item__quantity">
                    <button
                      type="button"
                      class="cart-item__qty-btn"
                      (click)="decreaseQuantity(item.id)"
                      [disabled]="item.quantity <= 1">
                      -
                    </button>
                    <span class="cart-item__qty-display">{{ item.quantity }}</span>
                    <button
                      type="button"
                      class="cart-item__qty-btn"
                      (click)="increaseQuantity(item.id)"
                      [disabled]="item.maxQuantity && item.quantity >= item.maxQuantity">
                      +
                    </button>
                  </div>

                  <!-- Subtotal -->
                  <div class="cart-item__subtotal-wrapper">
                    <span class="cart-item__subtotal-label">Subtotal</span>
                    <span class="cart-item__subtotal">
                      ${{ (item.price * item.quantity).toFixed(2) }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <button
              type="button"
              class="cart-item__remove"
              (click)="removeItem(item.id)"
              aria-label="Eliminar producto">
              √ó
            </button>
          </div>
        }
      </div>

      <!-- Resumen del carrito -->
      <div class="cart__summary">
        <div class="cart-summary">
          <h3 class="cart-summary__title">Resumen del pedido</h3>

          <div class="cart-summary__line">
            <span class="cart-summary__label">Subtotal:</span>
            <span class="cart-summary__value">${{ cartTotal().toFixed(2) }}</span>
          </div>

          <div class="cart-summary__line">
            <span class="cart-summary__label">IVA (21%):</span>
            <span class="cart-summary__value">${{ tax().toFixed(2) }}</span>
          </div>

          <hr class="cart-summary__divider">

          <div class="cart-summary__line cart-summary__line--total">
            <span class="cart-summary__label">Total:</span>
            <span class="cart-summary__value cart-summary__value--total">
              ${{ totalWithTax().toFixed(2) }}
            </span>
          </div>

          <!-- Secci√≥n de checkout -->
          <div class="cart-summary__checkout">
            @if (!showDeliveryOptions()) {
              <!-- Bot√≥n inicial de finalizar compra -->
              <button
                type="button"
                class="cart__btn cart__btn--primary cart__btn--full-width"
                (click)="onStartCheckout()">
                <span class="cart__btn-text">Finalizar compra</span>
                <span class="cart__btn-icon">‚Üí</span>
              </button>
            } @else {
              <!-- Opciones de entrega -->
              <div class="delivery-selection">
                <div class="delivery-selection__header">
                  <h4 class="delivery-selection__title">¬øC√≥mo quieres recibir tu pedido?</h4>
                  <p class="delivery-selection__subtitle">Selecciona una opci√≥n para continuar</p>
                </div>

                <div class="delivery-selection__options">
                  <!-- Opci√≥n: Env√≠o a domicilio -->
                  <label
                    class="delivery-option"
                    [class.delivery-option--selected]="selectedDeliveryOption() === 'delivery'">
                    <input
                      type="radio"
                      name="deliveryOption"
                      value="delivery"
                      [checked]="selectedDeliveryOption() === 'delivery'"
                      (change)="onSelectDeliveryOption('delivery')"
                      class="delivery-option__input">

                    <div class="delivery-option__content">
                      <div class="delivery-option__icon">üöö</div>
                      <div class="delivery-option__text">
                        <span class="delivery-option__title">Env√≠o a domicilio</span>
                        <span class="delivery-option__subtitle">Costo a convenir</span>
                        <span class="delivery-option__description">Entrega en 3-5 d√≠as h√°biles</span>
                      </div>
                    </div>

                    <div class="delivery-option__check">
                      @if (selectedDeliveryOption() === 'delivery') {
                        ‚úì
                      }
                    </div>
                  </label>

                  <!-- Opci√≥n: Retiro en tienda -->
                  <label
                    class="delivery-option"
                    [class.delivery-option--selected]="selectedDeliveryOption() === 'pickup'">
                    <input
                      type="radio"
                      name="deliveryOption"
                      value="pickup"
                      [checked]="selectedDeliveryOption() === 'pickup'"
                      (change)="onSelectDeliveryOption('pickup')"
                      class="delivery-option__input">

                    <div class="delivery-option__content">
                      <div class="delivery-option__icon">üè™</div>
                      <div class="delivery-option__text">
                        <span class="delivery-option__title">Retiro en tienda</span>
                        <span class="delivery-option__subtitle">Gratis</span>
                        <span class="delivery-option__description">Disponible en nuestro local</span>
                      </div>
                    </div>

                    <div class="delivery-option__check">
                      @if (selectedDeliveryOption() === 'pickup') {
                        ‚úì
                      }
                    </div>
                  </label>
                </div>

                <!-- Confirmaci√≥n de selecci√≥n -->
                @if (selectedDeliveryOption()) {
                  <div class="delivery-confirmation">
                    <div class="delivery-confirmation__content">
                      <span class="delivery-confirmation__icon">‚úÖ</span>
                      <div class="delivery-confirmation__text">
                        <strong>{{ deliveryText() }}</strong>
                        <span class="delivery-confirmation__detail">{{ deliverySubtext() }}</span>
                      </div>
                    </div>
                  </div>
                }

                <!-- Botones de acci√≥n -->
                <div class="delivery-selection__actions">
                  <button
                    type="button"
                    class="cart__btn cart__btn--secondary"
                    (click)="onCancelDeliverySelection()">
                    ‚Üê Volver
                  </button>

                  <button
                    type="button"
                    class="cart__btn cart__btn--primary"
                    [disabled]="!selectedDeliveryOption()"
                    (click)="onProceedToCheckout()">
                    Continuar ‚Üí
                  </button>
                </div>
              </div>
            }

            <!-- Bot√≥n secundario -->
            <button
              type="button"
              class="cart__btn cart__btn--ghost cart__btn--full-width"
              (click)="continueShopping()">
              ‚Üê Seguir comprando
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="cart__footer">
      <button
        type="button"
        class="cart__clear-btn"
        (click)="clearCart()"
        [disabled]="isEmpty()">
        Vaciar carrito
      </button>
    </div>
  }
</div>
